import{j as y,r as h,k as x,q as l,s,y as w,E as C,F as b,G as v,t as k,B as u,v as T,z as P,C as m,I,A as E,T as V,J as B,x as a,K as j,M as A,N as M}from"./DAn7dnkX.js";import{I as N,a as z}from"./NJcs9_DI.js";import{a as f,b as p,c as L}from"./BTbU19mV.js";const S={components:{IconClose:N,IconPensil:z},data(){return{token:"",categories:[],selectedCategory:"",toastMessage:"",toastTimeout:null,showToast:!1,selectedProduct:" "}},setup(){const t=h(""),e=h(!1),d=h(""),n=h(""),r=h([]),i=h("");return{oldName:t,writeActive:e,inputValue:d,id:n,products:r,typeCh:i}},mounted(){this.token=f.get("authtoken"),this.fetchProducts()},computed:{...x(L,["url"])},methods:{editing(t,e,d){this.writeActive=!this.writeActive,this.oldName=t,this.id=e,this.typeCh=d},togglePopup(t){t.showPopup=!t.showPopup,this.refCategory=t.showPopup},closePopup(t){const e=this.categories.find(d=>d.id===t);e&&(e.showPopup=!1)},createCategoriesObj(t){t.forEach(e=>{e.showPopup=!1,this.categoriesObj[e.id]=!1})},async getProductId(t){this.productID=t.target.value,await this.fetchCategory()},async deleteFn(t){this.id=t,await this.deleteCategory(),this.fetchCategory()},close(){this.inputValue="",this.writeActive=!1,this.id=""},async changeValue(){await this.modifyCategory(),this.fetchCategory(),this.close()},async fetchCategory(){try{const t=await p.get(`${this.url}api/cp/characteristics/${this.productID}/`,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.token}`}});t.data.message==="Error"?this.$router.push("/auth/login"):this.categories=t.data}catch(t){console.error("ОШИБКА:",t),this.$router.push("/auth/login"),f.remove("authtoken")}},async fetchProducts(){try{const t=await p.get(`${this.url}api/cp/products/`,{headers:{accept:"application/json",Authorization:`Bearer ${this.token}`}});this.products=t.data}catch(t){this.error=t}},async deleteCategory(){try{const t=await p.delete(`${this.url}api/cp/characteristics/?ids=${this.id}`,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.token}`}});t.data.message==="Error"?this.$router.push("/auth/login"):this.categories=t.data}catch(t){console.error("ОШИБКА:",t),this.$router.push("/auth/login"),f.remove("authtoken")}},async modifyCategory(){const t={type:this.typeCh,value:this.inputValue};try{await p.put(`${this.url}api/cp/characteristics/${this.id}/`,t,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.token}`}}),this.toastMessage="Успешно обновлено!",this.showToast=!0,this.toastTimeout&&clearTimeout(this.toastTimeout),this.toastTimeout=setTimeout(()=>{this.hideToast()},5e3)}catch(e){this.toastMessage="Ошибка при обновлении товара.",console.log(e),this.showToast=!0,this.toastTimeout&&clearTimeout(this.toastTimeout),this.toastTimeout=setTimeout(()=>{this.hideToast()},5e3)}},hideToast(){this.showToast=!1},beforeEnter(t){t.classList.add("toast-enter")},enter(t,e){t.addEventListener("animationend",e,{once:!0})},leave(t,e){t.classList.add("toast-exit"),t.addEventListener("animationend",e,{once:!0})}}},c=t=>(A("data-v-224382d0"),t=t(),M(),t),D={class:"page"},F=c(()=>s("div",{class:"sm:col-span-3"},[s("label",{for:"af-submit-application-linkedin-url",class:"inline-block text-sm font-medium text-black font-montserrat mt-2.5"}," Выбрать товар ")],-1)),$={class:"sm:col-span-9"},O={class:"w-full md:w-full"},U=["value"],q={key:0,class:"write"},G={class:"write--wrapper"},J={class:"write--text font-montserrat"},K={class:"list"},H={class:"list--text font-montserrat"},Q={class:"list--wrapper"},R=["onClick"],W=c(()=>s("div",{class:"list--dot"},null,-1)),X=c(()=>s("div",{class:"list--dot"},null,-1)),Y=c(()=>s("div",{class:"list--dot"},null,-1)),Z=[W,X,Y],tt=["onClick"],et=["onClick"],st={class:"toast fixed top-4 left-4 max-w-xs bg-gray-600 border border-rose-300 rounded-xl shadow-lg :",role:"alert",tabindex:"-1","aria-labelledby":"hs-toast-error-example-label"},ot={class:"toast flex p-4"},it=c(()=>s("div",{class:"shrink-0"},null,-1)),at={class:"ms-3"},nt={id:"hs-toast-error-example-label",class:"text-sm text-pink-700 dark:text-pink-300"},rt=c(()=>s("span",{class:"sr-only"},"Close",-1)),lt=c(()=>s("svg",{class:"shrink-0 size-4",xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[s("path",{d:"M18 6 6 18"}),s("path",{d:"m6 6 12 12"})],-1)),ct=[rt,lt];function dt(t,e,d,n,r,i){const _=B("IconClose");return a(),l("div",D,[F,s("div",$,[s("div",O,[w(s("select",{"onUpdate:modelValue":e[0]||(e[0]=o=>r.selectedProduct=o),onChange:e[1]||(e[1]=o=>i.getProductId(o)),class:"font-montserrat py-2 px-3 pe-11 block w-full border-gray-300 border-gray-400 text-black shadow-sm text-sm rounded-lg focus:border-pink-500 focus:ring-pink-500 disabled:opacity-50 disabled:pointer-events-none",style:{overflow:"hidden","overflow-y":"auto","max-height":"72px"}},[(a(!0),l(b,null,v(n.products,o=>(a(),l("option",{key:o.id,value:o.id,class:"py-2 px-4 text-sm text-black cursor-pointer font-montserrat hover:bg-white rounded-lg focus:outline-none focus:bg-white"},u(o.name),9,U))),128))],544),[[C,r.selectedProduct]])])]),n.writeActive?(a(),l("label",q,[s("div",G,[s("p",J,[k(" Переименовать "),s("b",null,u(n.oldName),1),k(" в: ")]),s("button",{onClick:e[2]||(e[2]=o=>i.close()),class:"write--close"},[T(_)])]),w(s("input",{"onUpdate:modelValue":e[3]||(e[3]=o=>n.inputValue=o),type:"text",class:"font-montserrat py-2 px-3 pe-11 block w-full border-gray-300 border-gray-400 text-black shadow-sm text-sm rounded-lg focus:border-pink-500 focus:ring-pink-500 disabled:opacity-50 disabled:pointer-events-none write--input"},null,512),[[P,n.inputValue]]),s("button",{onClick:e[4]||(e[4]=o=>i.changeValue()),class:"write--rename font-montserrat w-full py-3 px-4 inline-flex justify-center items-center gap-x-2 text-sm font-medium rounded-lg border border-transparent bg-pink-600 text-white hover:bg-white hover:text-black transition focus:outline-none focus:bg-white disabled:opacity-50 disabled:pointer-events-none"},"Переименовать")])):m("",!0),s("ul",K,[(a(!0),l(b,null,v(r.categories,o=>(a(),l("li",{class:"list--item",key:o.id},[s("p",H,u(o.value),1),s("div",Q,[s("button",{class:"list--show",onClick:g=>i.togglePopup(o)},Z,8,R),o.showPopup?(a(),l("div",{key:0,class:"list--popup",onClick:e[5]||(e[5]=j(()=>{},["stop"]))},[s("button",{onClick:g=>i.editing(o.value,o.id,o.type),class:"list--button font-montserrat"}," Изменить объект ",8,tt),s("button",{onClick:g=>i.deleteFn(o.id),class:"list--button font-montserrat"}," Удалить объект ",8,et)])):m("",!0)])]))),128))]),r.showToast?(a(),I(V,{key:1,name:"toast",onBeforeEnter:i.beforeEnter,onEnter:i.enter,onLeave:i.leave},{default:E(()=>[s("div",st,[s("div",ot,[it,s("div",at,[s("p",nt,u(r.toastMessage),1)]),s("button",{type:"button",class:"inline-flex shrink-0 justify-center items-center size-5 rounded-lg text-white bg-pink-900 hover:bg-pink-600 focus:outline-none focus:bg-white","aria-label":"Close",onClick:e[6]||(e[6]=(...o)=>i.hideToast&&i.hideToast(...o))},ct)])])]),_:1},8,["onBeforeEnter","onEnter","onLeave"])):m("",!0)])}const mt=y(S,[["render",dt],["__scopeId","data-v-224382d0"]]);export{mt as default};
