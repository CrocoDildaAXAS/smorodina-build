import{I as b,a as _}from"./NJcs9_DI.js";import{a as u,b as p,c as v}from"./BTbU19mV.js";import{j as C,r as c,k as y,q as d,s,t as w,B as m,v as x,y as T,z as E,C as g,F as j,G as P,I as V,A as B,T as A,J as I,x as n,K as L,M,N}from"./DAn7dnkX.js";const z={components:{IconClose:b,IconPensil:_},data(){return{token:"",categories:[],selectedCategory:"",toastMessage:"",toastTimeout:null,showToast:!1,categoriesObj:{}}},setup(){const t=c(""),e=c(!1),h=c(""),a=c(""),l=c(!1);return{oldName:t,writeActive:e,inputValue:h,id:a,refCategory:l}},mounted(){this.token=u.get("authtoken"),this.fetchCategory(),document.addEventListener("click",this.handleDocumentClick)},beforeUnmount(){document.removeEventListener("click",this.handleDocumentClick)},computed:{...y(v,["url"])},methods:{editing(t,e){this.writeActive=!this.writeActive,this.oldName=t,this.id=e,this.closePopup(e)},handleDocumentClick(t){this.refCategory||this.categories.forEach(e=>{e.showPopup=!1})},async deleteFn(t){this.id=t,await this.deleteCategory(),this.fetchCategory()},togglePopup(t){t.showPopup=!t.showPopup,this.refCategory=t.showPopup},closePopup(t){const e=this.categories.find(h=>h.id===t);e&&(e.showPopup=!1)},createCategoriesObj(t){t.forEach(e=>{e.showPopup=!1,this.categoriesObj[e.id]=!1}),console.log("categoriesObj:",this.categoriesObj)},close(){this.inputValue="",this.writeActive=!1,this.id=""},async changeValue(){await this.modifyCategory(),this.fetchCategory(),this.close()},async fetchCategory(){try{const t=await p.get(`${this.url}api/cp/categories/`,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.token}`}});await this.createCategoriesObj(t.data),t.data.message==="Error"?this.$router.push("/auth/login"):(this.categories=t.data,console.log(this.categories))}catch(t){console.error("ОШИБКА:",t),this.$router.push("/auth/login"),u.remove("authtoken")}},async deleteCategory(){try{const t=await p.delete(`${this.url}api/cp/categories/?ids=${this.id}`,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.token}`}});t.data.message==="Error"?this.$router.push("/auth/login"):(this.categories=t.data,console.log(this.categories))}catch(t){console.error("ОШИБКА:",t),this.$router.push("/auth/login"),u.remove("authtoken")}},async modifyCategory(){try{const t={name:this.inputValue};await p.put(`${this.url}api/cp/categories/${this.id}/`,t,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.token}`}}),console.log(t),this.toastMessage="Успешно обновлено!",this.showToast=!0,this.toastTimeout&&clearTimeout(this.toastTimeout),this.toastTimeout=setTimeout(()=>{this.hideToast()},5e3)}catch(t){this.toastMessage="Ошибка при обновлении товара.",console.log(t),this.showToast=!0,this.toastTimeout&&clearTimeout(this.toastTimeout),this.toastTimeout=setTimeout(()=>{this.hideToast()},5e3)}},hideToast(){this.showToast=!1},beforeEnter(t){t.classList.add("toast-enter")},enter(t,e){t.addEventListener("animationend",e,{once:!0})},leave(t,e){t.classList.add("toast-exit"),t.addEventListener("animationend",e,{once:!0})}}},r=t=>(M("data-v-c6798774"),t=t(),N(),t),O={class:"page"},D={key:0,class:"write"},S={class:"write--wrapper"},$={class:"write--text font-montserrat"},F={class:"list"},U={class:"list--text font-montserrat"},q={class:"list--wrapper"},G=["onClick"],J=r(()=>s("div",{class:"list--dot"},null,-1)),K=r(()=>s("div",{class:"list--dot"},null,-1)),H=r(()=>s("div",{class:"list--dot"},null,-1)),Q=[J,K,H],R=["onClick"],W=["onClick"],X={class:"toast fixed top-4 left-4 max-w-xs bg-gray-600 border border-rose-300 rounded-xl shadow-lg",role:"alert",tabindex:"-1","aria-labelledby":"hs-toast-error-example-label"},Y={class:"toast flex p-4"},Z=r(()=>s("div",{class:"shrink-0"},null,-1)),tt={class:"ms-3"},et={id:"hs-toast-error-example-label",class:"text-sm text-pink-700 dark:text-pink-300"},st=r(()=>s("span",{class:"sr-only"},"Close",-1)),ot=r(()=>s("svg",{class:"shrink-0 size-4",xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[s("path",{d:"M18 6 6 18"}),s("path",{d:"m6 6 12 12"})],-1)),it=[st,ot];function at(t,e,h,a,l,i){const k=I("IconClose");return n(),d("div",O,[a.writeActive?(n(),d("label",D,[s("div",S,[s("p",$,[w(" Переименовать "),s("b",null,m(a.oldName),1),w(" в: ")]),s("button",{onClick:e[0]||(e[0]=o=>i.close()),class:"write--close"},[x(k)])]),T(s("input",{"onUpdate:modelValue":e[1]||(e[1]=o=>a.inputValue=o),type:"text",class:"font-montserrat py-2 px-3 pe-11 block w-full border-gray-300 border-gray-400 text-black shadow-sm text-sm rounded-lg focus:border-pink-500 focus:ring-pink-500 disabled:opacity-50 disabled:pointer-events-none write--input"},null,512),[[E,a.inputValue]]),s("button",{onClick:e[2]||(e[2]=o=>i.changeValue()),class:"write--rename font-montserrat w-full py-3 px-4 inline-flex justify-center items-center gap-x-2 text-sm font-medium rounded-lg border border-transparent bg-pink-600 text-white hover:bg-white hover:text-black transition focus:outline-none focus:bg-white disabled:opacity-50 disabled:pointer-events-none"}," Переименовать ")])):g("",!0),s("ul",F,[(n(!0),d(j,null,P(l.categories,o=>(n(),d("li",{class:"list--item",key:o.id},[s("p",U,m(o.name),1),s("div",q,[s("button",{class:"list--show",onClick:f=>i.togglePopup(o)},Q,8,G),o.showPopup?(n(),d("div",{key:0,class:"list--popup",onClick:e[3]||(e[3]=L(()=>{},["stop"]))},[s("button",{onClick:f=>i.editing(o.name,o.id),class:"list--button font-montserrat"}," Изменить объект ",8,R),s("button",{onClick:f=>i.deleteFn(o.id),class:"list--button font-montserrat"}," Удалить объект ",8,W)])):g("",!0)])]))),128))]),l.showToast?(n(),V(A,{key:1,name:"toast",onBeforeEnter:i.beforeEnter,onEnter:i.enter,onLeave:i.leave},{default:B(()=>[s("div",X,[s("div",Y,[Z,s("div",tt,[s("p",et,m(l.toastMessage),1)]),s("button",{type:"button",class:"inline-flex shrink-0 justify-center items-center size-5 rounded-lg text-white bg-pink-900 hover:bg-pink-600 focus:outline-none focus:bg-white","aria-label":"Close",onClick:e[4]||(e[4]=(...o)=>i.hideToast&&i.hideToast(...o))},it)])])]),_:1},8,["onBeforeEnter","onEnter","onLeave"])):g("",!0)])}const ct=C(z,[["render",at],["__scopeId","data-v-c6798774"]]);export{ct as default};
